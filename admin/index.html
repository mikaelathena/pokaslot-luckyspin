<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin POKASLOT - Lucky Wheel Spin</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body { background: #000; color: white; padding: 30px; }
    h1 { color: gold; }
    .form-inline select, .form-inline button { margin: 0 10px 10px 0; }
    table th, table td { color: white; }
    .claimed { color: #f00; font-weight: bold; }
    .unclaimed { color: #0f0; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ POKASLOT ADMIN LUCKY SPIN</h1>

  <form id="generateForm" class="form-inline">
    <select id="prizeInput" class="form-control" required>
      <option value="">-- Pilih Hadiah --</option>
      <option>30.000</option>
      <option>500.000</option>
      <option>FREE SPIN</option>
      <option>50.000</option>
      <option>IPHONE 14</option>
      <option>88.000</option>
      <option>10.000</option>
      <option>1.000.000</option>
      <option>HONDA BEAT</option>
      <option>15.000</option>
      <option>2.500.000</option>
      <option>25.000</option>
    </select>
    <button type="submit" class="btn btn-warning">Generate Kode</button>
  </form>

  <hr style="background: white;">

  <h3>ðŸ§¾ Daftar Kode</h3>
  <table class="table table-dark table-sm">
    <thead>
      <tr>
        <th>ID</th>
        <th>Kode</th>
        <th>Hadiah</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="codeTable"></tbody>
  </table>

  <script>
    async function fetchCodes() {
      const res = await fetch('/api/admin/codes');
      const data = await res.json();
      const tbody = document.getElementById('codeTable');
      tbody.innerHTML = '';
      data.codes.forEach(code => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${code.id}</td>
          <td>${code.code}</td>
          <td>${code.prize}</td>
          <td class="${code.claimed ? 'claimed' : 'unclaimed'}">${code.claimed ? 'CLAIMED' : 'BELUM'}</td>
        `;
        tbody.appendChild(row);
      });
    }

    document.getElementById('generateForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const prize = document.getElementById('prizeInput').value.trim();
      if (!prize) return alert('Pilih hadiah terlebih dahulu');
      const res = await fetch('/api/admin/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prize })
      });
      const data = await res.json();
      if (data.success) {
        alert(`Kode berhasil dibuat: ${data.code}`);
        document.getElementById('prizeInput').value = '';
        fetchCodes();
      } else {
        alert(data.message);
      }
    });

    fetchCodes();
  </script>
</body>
</html>